!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=16)}([function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t,n){var r=n(6),o=n(0);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?o(e):t}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var r=n(7);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},,,,,,,,,function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),i=n(2),a=n.n(i),s=n(3),l=n.n(s),u=n(4),c=n.n(u),p=n(0),f=n.n(p),g=n(5),h=n.n(g),d=wp.i18n.__,y=function(e){function t(e){var n;return o()(this,t),(n=l()(this,c()(t).call(this,e))).renderDeactivatePluginOption=n.renderDeactivatePluginOption.bind(f()(n)),n.renderProgressBar=n.renderProgressBar.bind(f()(n)),n.renderLog=n.renderLog.bind(f()(n)),n.deactivateBylines=n.deactivateBylines.bind(f()(n)),n.startMigration=n.startMigration.bind(f()(n)),n.clickStart=n.clickStart.bind(f()(n)),n.reset=n.reset.bind(f()(n)),n.migrateChunkOfData=n.migrateChunkOfData.bind(f()(n)),n.getBylinesMigrationInitialData=n.getBylinesMigrationInitialData.bind(f()(n)),n.state={totalToMigrate:0,totalMigrated:0,inProgress:!1,chunkSize:n.props.chunkSize,progress:0,log:"",showDeactivateOption:!1,disablingBylines:!1},n}return h()(t,e),a()(t,[{key:"clickStart",value:function(e){e.preventDefault(),this.startMigration()}},{key:"getBylinesMigrationInitialData",value:function(e){var t=this,n=this;this.setState({log:d("Collecting data for the migration...","publishpress-authors")}),window.setTimeout((function(){jQuery.ajax({type:"GET",dataType:"json",url:ajaxurl,async:!1,data:{action:"get_bylines_migration_data",nonce:t.props.nonce},success:function(t){return t.success?(n.setState({totalToMigrate:t.total}),void e()):void n.setState({progress:0,inProgress:!1,log:d("Error: ","publishpress-authors")+t.error,showDeactivateOption:!1})},error:function(e,t,r){n.setState({progress:0,inProgress:!1,log:d("Error: ","publishpress-authors")+r+" ["+t+"]",showDeactivateOption:!1})}})}),1e3)}},{key:"migrateChunkOfData",value:function(){var e=this;jQuery.ajax({type:"GET",dataType:"json",url:ajaxurl,data:{action:"migrate_bylines",nonce:this.props.nonce,chunkSize:this.state.chunkSize},success:function(t){if(t.success){var n=e.state.totalMigrated+e.state.chunkSize;if(n>e.state.totalToMigrate&&(n=e.state.totalToMigrate),e.setState({totalMigrated:n,progress:2+Math.floor(98/e.state.totalToMigrate*n)}),n<e.state.totalToMigrate)e.migrateChunkOfData();else{var r=d("Done! Bylines data was copied and you can deactivate the plugin.","publishpress-authors");e.setState({progress:100,log:r,showDeactivateOption:!0}),window.setTimeout((function(){e.setState({inProgress:!1})}),1e3)}}else e.setState({progress:0,inProgress:!1,log:d("Error: ","publishpress-authors")+t.error,showDeactivateOption:!1})},error:function(t,n,r){e.setState({progress:0,inProgress:!1,log:d("Error: ","publishpress-authors")+r+" ["+n+"]",showDeactivateOption:!1})}})}},{key:"startMigration",value:function(){var e=this;this.setState({progress:1,inProgress:!0,log:d("Please, wait...","publishpress-authors"),showDeactivateOption:!1}),window.setTimeout((function(){e.getBylinesMigrationInitialData((function(){e.setState({progress:2,log:d("Copying authors' data...","publishpress-authors")}),e.migrateChunkOfData()}))}),1e3)}},{key:"deactivateBylines",value:function(){var e=this;this.setState({disablingBylines:!0,log:d("Deactivating Bylines...","publishpress-authors")}),jQuery.ajax({type:"GET",dataType:"json",url:ajaxurl,data:{action:"deactivate_bylines",nonce:this.props.nonce},success:function(){e.setState({disablingBylines:!1,log:d("Done! Bylines is deactivated.","publishpress-authors"),showDeactivateOption:!1})},error:function(t,n,r){e.setState({disablingBylines:!1,log:d("Error: ","publishpress-authors")+r+" ["+n+"]"})}})}},{key:"renderDeactivatePluginOption",value:function(){var e=d("Deactivate Bylines","publishpress-authors"),t=!this.state.disablingBylines;return wp.element.createElement(b,{label:e,onClick:this.deactivateBylines,enabled:t})}},{key:"reset",value:function(){this.setState({progress:0,inProgress:!1})}},{key:"renderProgressBar",value:function(){return wp.element.createElement(m,{value:this.state.progress})}},{key:"renderLog",value:function(){return wp.element.createElement(v,{log:this.state.log,show:this.state.showDeactivateOption})}},{key:"render",value:function(){var e=!this.state.inProgress,t=this.state.inProgress?this.renderProgressBar():"",n=""==this.state.log?"":this.renderLog(),r=this.state.showDeactivateOption?this.renderDeactivatePluginOption():"";return wp.element.createElement("div",null,wp.element.createElement(b,{label:d("Copy Bylines Data","publishpress-authors"),onClick:this.startMigration,enabled:e}),r,t,n)}}]),t}(React.Component),b=function(e){function t(e){return o()(this,t),l()(this,c()(t).call(this,e))}return h()(t,e),a()(t,[{key:"render",value:function(){var e=!this.props.enabled;return wp.element.createElement("input",{type:"button",className:"button button-secondary button-danger ppma_maintenance_button",onClick:this.props.onClick,disabled:e,value:this.props.label})}}]),t}(React.Component),v=function(e){function t(e){return o()(this,t),l()(this,c()(t).call(this,e))}return h()(t,e),a()(t,[{key:"render",value:function(){return wp.element.createElement("div",null,wp.element.createElement("div",{class:"ppma_maintenance_log",readOnly:!0},this.props.log))}}]),t}(React.Component),m=function(e){function t(e){return o()(this,t),l()(this,c()(t).call(this,e))}return h()(t,e),a()(t,[{key:"renderLabel",value:function(){return wp.element.createElement("div",{className:"p-progressbar-label"},this.props.value," %")}},{key:"render",value:function(){var e=this.renderLabel();return wp.element.createElement("div",{role:"progressbar",id:this.props.id,className:"p-progressbar p-component p-progressbar-determinate",style:this.props.style,"aria-valuemin":"0","aria-valuenow":this.props.value,"aria-valuemax":"100","aria-label":this.props.value},wp.element.createElement("div",{className:"p-progressbar-value p-progressbar-value-animate",style:{width:this.props.value+"%",display:"block"}}),e)}}]),t}(React.Component);jQuery((function(){ReactDOM.render(wp.element.createElement(y,{notMigratedPostsId:ppmaBylinesMigration.notMigratedPostsId,nonce:ppmaBylinesMigration.nonce,chunkSize:5}),document.getElementById("publishpress-authors-bylines-migration"))}))}]);